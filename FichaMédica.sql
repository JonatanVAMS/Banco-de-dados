CREATE DATABASE REGISTRO_SAUDE;

USE REGISTRO_SAUDE;

CREATE TABLE CLIENTE(
	ID_CLIENTE INT PRIMARY KEY AUTO_INCREMENT,
    NOME_COMPLETO VARCHAR(50),
    DATA_NASCIMENTO DATE,
    GENERO ENUM('Masculino', 'Feminino'),
    SITUACAO_CONJUGAL VARCHAR(20),
    LOCAL_RESIDENCIA TEXT,
    DOCUMENTO_ID VARCHAR(20),
    CONTATO VARCHAR(20),
    PLANO_SAUDE VARCHAR(100)
);

CREATE TABLE PROFISSIONAL(
	ID_PROFISSIONAL INT PRIMARY KEY AUTO_INCREMENT,
    NOME_COMPLETO VARCHAR(100) NOT NULL
);

CREATE TABLE ATENDIMENTO(
	ID_ATENDIMENTO INT PRIMARY KEY AUTO_INCREMENT,
    ID_CLIENTE INT NOT NULL,
    ID_PROFISSIONAL INT NOT NULL,
    DATA_ATENDIMENTO DATE,
    LAUDO TEXT,
    FOREIGN KEY (ID_CLIENTE) REFERENCES CLIENTE(ID_CLIENTE),
    FOREIGN KEY (ID_PROFISSIONAL) REFERENCES PROFISSIONAL(ID_PROFISSIONAL)
);

CREATE TABLE ANALISE(
	ID_ANALISE INT PRIMARY KEY AUTO_INCREMENT,
    ID_ATENDIMENTO INT NOT NULL,
    TIPO_ANALISE VARCHAR(100) NOT NULL,
    DATA_ANALISE DATE,
    FOREIGN KEY (ID_ATENDIMENTO) REFERENCES ATENDIMENTO(ID_ATENDIMENTO)
);

INSERT INTO CLIENTE (ID_CLIENTE, NOME_COMPLETO, DATA_NASCIMENTO, GENERO, SITUACAO_CONJUGAL, LOCAL_RESIDENCIA, DOCUMENTO_ID, CONTATO, PLANO_SAUDE) VALUES
(1, 'Lucas Pereira', '2002-04-15', 'Masculino', 'Solteiro', 'Centro', '12345678', '47991234567', 'Unimed' ),
(2, 'Gabriel Oliveira', '2000-09-09', 'Masculino', 'Casado', 'Jardim América', '87654321', '47998765432', 'Bradesco Saúde' ),
(3, 'Camila Torres', '2003-11-27', 'Feminino', 'Solteira', 'São José', '11223344', '47993456789', 'SulAmérica' ),
(4, 'Fernanda Silva', '2001-07-01', 'Feminino', 'Namorando', 'Vila Nova', '55667788', '47997654321', 'Amil' );

INSERT INTO PROFISSIONAL (ID_PROFISSIONAL, NOME_COMPLETO) VALUES
(1, 'Dr. Henrique Moraes'),
(2, 'Dra. Amanda Nunes'),
(3, 'Dr. Rafael Teixeira'),
(4, 'Dra. Lúcia Castro');

INSERT INTO ATENDIMENTO (ID_ATENDIMENTO, ID_CLIENTE, ID_PROFISSIONAL, DATA_ATENDIMENTO, LAUDO) VALUES
(1, 1, 2, '2025-01-10', 'Inflamação na garganta'),
(2, 2, 3, '2024-03-15', 'Lesão muscular leve'),
(3, 3, 1, '2023-11-20', 'Crise de ansiedade'),
(4, 4, 4, '2023-05-05', 'Dor abdominal persistente');

INSERT INTO ANALISE (ID_ANALISE, ID_ATENDIMENTO, TIPO_ANALISE, DATA_ANALISE) VALUES
(1, 1, 'Hemograma completo', '2025-01-10'),
(2, 2, 'Ressonância Magnética', '2024-03-15'),
(3, 3, 'Eletrocardiograma', '2023-11-20'),
(4, 4, 'Ultrassonografia', '2023-05-05');

SELECT * FROM CLIENTE;

SELECT * FROM PROFISSIONAL
ORDER BY NOME_COMPLETO;

SELECT 
    C.NOME_COMPLETO AS CLIENTE,
    P.NOME_COMPLETO AS PROFISSIONAL,
    A.DATA_ATENDIMENTO
FROM ATENDIMENTO A
JOIN CLIENTE C ON A.ID_CLIENTE = C.ID_CLIENTE
JOIN PROFISSIONAL P ON A.ID_PROFISSIONAL = P.ID_PROFISSIONAL;

SELECT * FROM ANALISE
WHERE DATA_ANALISE > '2023-12-31';

SELECT * FROM ATENDIMENTO
WHERE LAUDO LIKE '%dor%';

SELECT COUNT(*) AS TOTAL_AMIL
FROM CLIENTE
WHERE PLANO_SAUDE = 'Amil';

SELECT 
    C.NOME_COMPLETO AS CLIENTE,
    A.TIPO_ANALISE,
    A.DATA_ANALISE
FROM ANALISE A
JOIN ATENDIMENTO ATD ON A.ID_ATENDIMENTO = ATD.ID_ATENDIMENTO
JOIN CLIENTE C ON ATD.ID_CLIENTE = C.ID_CLIENTE;

SELECT * FROM CLIENTE
WHERE YEAR(CURDATE()) - YEAR(DATA_NASCIMENTO) > 18;

SELECT 
    C.NOME_COMPLETO AS CLIENTE,
    A.DATA_ATENDIMENTO,
    A.LAUDO
FROM ATENDIMENTO A
JOIN CLIENTE C ON A.ID_CLIENTE = C.ID_CLIENTE
ORDER BY A.DATA_ATENDIMENTO DESC;

SELECT 
    P.NOME_COMPLETO AS PROFISSIONAL,
    COUNT(A.ID_ATENDIMENTO) AS TOTAL_ATENDIMENTOS
FROM PROFISSIONAL P
JOIN ATENDIMENTO A ON P.ID_PROFISSIONAL = A.ID_PROFISSIONAL
GROUP BY P.ID_PROFISSIONAL;
